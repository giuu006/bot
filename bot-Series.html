<!DOCTYPE html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Movie Assistant - IA</title>
  <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            /* Fundo Cinematogr√°fico */
            background: linear-gradient(135deg, #1f1c2c 0%, #090e1a 100%);
            min-height: 100%;
            color: #fff;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            /* Cores de Cinema: Dourado e Roxo */
            background: linear-gradient(45deg, #ffd700, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            overflow: hidden;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            max-height: 500px;
            min-height: 300px;
        }

        .message {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 10px;
            max-width: 80%;
            word-wrap: break-word;
        }

        .user-message {
            /* Cor de destaque do usu√°rio */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin-left: auto;
            text-align: right;
        }

        .bot-message {
            /* Cor de destaque do bot */
            background: rgba(255, 255, 255, 0.15);
            margin-right: auto;
        }

        .chat-input-container {
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 25px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 1rem;
            outline: none;
        }

        .chat-input::placeholder {
            color: #666;
        }

        .send-button {
            padding: 15px 25px;
            background: linear-gradient(135deg, #ffd700 0%, #ff6b6b 100%);
            color: #1f1c2c;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: transform 0.2s;
        }

        .send-button:hover {
            transform: translateY(-2px);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #ffd700;
        }

        .loading.show {
            display: block;
        }

        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .media-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
            transition: transform 0.3s;
            cursor: pointer;
        }

        .media-card:hover {
            transform: translateY(-5px);
        }

        .media-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: #ffd700;
        }

        .media-info {
             font-size: 0.9rem;
             opacity: 0.8;
             margin-bottom: 10px;
        }

        .media-genre {
             background: #764ba2;
             color: white;
             padding: 5px 10px;
             border-radius: 15px;
             font-size: 0.8rem;
             display: inline-block;
        }


        .status-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .status-online {
            background: #4CAF50;
            color: white;
        }

        .status-offline {
            background: #f44336;
            color: white;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .message {
                max-width: 95%;
            }

            .media-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body>
  <div class="container">
   <div class="status-indicator" id="statusIndicator">
    üîÑ Conectando...
   </div>
   <div class="header">
    <h1>üé¨ Movie Assistant</h1>
    <p>Seu assistente inteligente para filmes e s√©ries com Google Gemini AI</p>
    <div style="margin-top: 15px; font-size: 0.9rem; opacity: 0.8;">
     <p>üë®‚Äçüíª Desenvolvido por: <strong>Lucas Tenutti </strong> &amp; <strong>Giulia de Assis</strong></p>
    </div>
   </div>
   <div class="chat-container">
    <div class="chat-messages" id="chatMessages">
     <div class="message bot-message"><strong>ü§ñ Movie Assistant:</strong><br>
       Ol√°! Sou seu assistente de filmes e s√©ries. Posso ajudar com: <br>
      ‚Ä¢ Informa√ß√µes sobre t√≠tulos <br>
      ‚Ä¢ Recomenda√ß√µes de streaming <br>
      ‚Ä¢ Elenco e diretores <br>
      ‚Ä¢ Avalia√ß√µes e curiosidades <br><br>
      Pergunte sobre qualquer filme ou s√©rie! üçø
     </div>
    </div>
    <div class="loading" id="loading">
     ü§ñ Pensando... Consultando Google Gemini AI
    </div>
    <div class="chat-input-container"><input type="text" class="chat-input" id="chatInput" placeholder="Pergunte sobre filmes e s√©ries..." maxlength="500"> <button class="send-button" id="sendButton"> Enviar üöÄ </button>
    </div>
   </div>
   <div class="media-grid" id="mediaGrid"></div>
  </div>
  <script>
        // Configura√ß√£o da API Google Gemini
        // ***SUBSTITUA PELO SEU CHAVE V√ÅLIDA***
        const GOOGLE_API_KEY = 'AIzaSyCK9DIAxqEBk_1AB7srQFghFOLGlnzgjTE'; 
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent?key=${GOOGLE_API_KEY}`;

        // Base de dados local de Filmes e S√©ries (Exemplos)
       const mediaDatabase = {
            'breaking bad': {
                name: 'Breaking Bad',
                type: 'S√©rie',
                year: '2008‚Äì2013',
                rating: '9.5/10 (IMDb)',
                genre: 'Crime / Drama',
                description: 'Um professor de qu√≠mica se transforma em fabricante de metanfetamina.'
            },
            'a origem': {
                name: 'A Origem (Inception)',
                type: 'Filme',
                year: '2010',
                rating: '8.8/10 (IMDb)',
                genre: 'Sci-fi / Suspense',
                description: 'Um ladr√£o invade sonhos para roubar segredos corporativos.'
            },
            'stranger things': {
                name: 'Stranger Things',
                type: 'S√©rie',
                year: '2016‚ÄìPresente',
                rating: '8.7/10 (IMDb)',
                genre: 'Fic√ß√£o Cient√≠fica / Terror',
                description: 'Crian√ßas investigam fen√¥menos sobrenaturais em uma cidade pequena.'
            },
            'parasita': {
                name: 'Parasita (Parasite)',
                type: 'Filme',
                year: '2019',
                rating: '8.5/10 (IMDb)',
                genre: 'Com√©dia / Drama / Thriller',
                description: 'Uma fam√≠lia pobre se infiltra na vida de uma fam√≠lia rica.'
            },
        };

        // Elementos DOM
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const sendButton = document.getElementById('sendButton');
        const loading = document.getElementById('loading');
        const statusIndicator = document.getElementById('statusIndicator');
        const mediaGrid = document.getElementById('mediaGrid');

        // Estado da aplica√ß√£o
        let isLoading = false;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadPopularMedia();
            testAPIConnection();
        });

        function initializeApp() {
            // Event listeners
            sendButton.addEventListener('click', sendMessage);
            chatInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Foco no input
            chatInput.focus();
        }

        async function testAPIConnection() {
            console.log('üîç Testando conex√£o com Google Gemini API...');
            
            try {
                const testBody = {
                    contents: [{
                        parts: [{
                            text: 'Ol√°! Este √© um teste de conex√£o.'
                        }]
                    }],
                    generationConfig: {
                        temperature: 0.1,
                        maxOutputTokens: 50,
                    }
                };

                const response = await fetch(GEMINI_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testBody)
                });

                if (response.ok) {
                    // const data = await response.json();
                    updateStatus('online', '‚úÖ Google Gemini AI Online');
                } else {
                    updateStatus('offline', `‚ùå API Error: ${response.status}`);
                }
            } catch (error) {
                console.error('‚ùå Erro na conex√£o:', error);
                updateStatus('offline', '‚ùå Conex√£o Falhou');
            }
        }

        function updateStatus(status, message) {
            statusIndicator.className = `status-indicator status-${status}`;
            statusIndicator.textContent = message;
        }

        function loadPopularMedia() {
            mediaGrid.innerHTML = '';
            
            Object.values(mediaDatabase).forEach(media => {
                const mediaCard = createMediaCard(media);
                mediaGrid.appendChild(mediaCard);
            });
        }

        function createMediaCard(media) {
            const card = document.createElement('div');
            card.className = 'media-card';
            
            card.innerHTML = `
                <div class="media-title">üé¨ ${media.name}</div>
                <div class="media-info">
                    ${media.type} (${media.year}) | ‚≠ê ${media.rating}
                </div>
                <div class="media-genre">${media.genre}</div>
            `;
            card.addEventListener('click', () => {
                chatInput.value = `Me fale sobre ${media.name}`;
                sendMessage();
            });

            return card;
        }

        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message || isLoading) return;

            console.log('üí¨ Enviando mensagem:', message);

            // Adiciona mensagem do usu√°rio
            addMessage(message, 'user');
            chatInput.value = '';
            
            // Mostra loading
            setLoading(true);

            try {
                // Primeiro tenta buscar na base local
                console.log('üîç Buscando na base local...');
                const localResult = searchLocalMedia(message);
                if (localResult) {
                    console.log('‚úÖ Encontrado na base local');
                    addMessage(localResult, 'bot');
                    setLoading(false);
                    return;
                }

                console.log('‚ùå N√£o encontrado na base local, consultando Gemini API...');
                // Se n√£o encontrar, usa a API do Gemini
                const response = await queryGeminiAPI(message);
                console.log('‚úÖ Resposta recebida do Gemini');
                addMessage(response, 'bot');

            } catch (error) {
                console.error('‚ùå Erro completo no sendMessage:', error);
                addMessage(`‚ùå Erro: ${error.message}\n\nTente perguntar sobre os t√≠tulos em destaque abaixo ou verifique o console para mais detalhes.`, 'bot');
            } finally {
                setLoading(false);
            }
        }

        function searchLocalMedia(query) {
            const queryLower = query.toLowerCase();
            
            // Busca exata na chave
            if (mediaDatabase[queryLower]) {
                return formatMediaInfo(mediaDatabase[queryLower]);
            }
            
            // Busca parcial no nome do filme/s√©rie
            const mediaMatch = Object.values(mediaDatabase).find(media => 
                media.name.toLowerCase().includes(queryLower)
            );

            if (mediaMatch) {
                return formatMediaInfo(mediaMatch);
            }
            
            return null;
        }

        function formatMediaInfo(media) {
            let info = `üé¨ **${media.name}**\n\n`;
            info += `üìå **Tipo:** ${media.type}\n`;
            info += `üìÖ **Ano:** ${media.year}\n`;
            info += `‚≠ê **Avalia√ß√£o:** ${media.rating}\n`;
            info += `üé≠ **G√™nero:** ${media.genre}\n`;
            info += `üìù **Descri√ß√£o:** ${media.description}\n`;
            return info;
        }

        async function queryGeminiAPI(message) {
            console.log('ü§ñ Consultando Google Gemini API...');
            
            const prompt = `Voc√™ √© um assistente especializado em Filmes, S√©ries de TV e plataformas de streaming (Netflix, HBO Max, Prime Video, etc.). 
Responda de forma clara, objetiva e amig√°vel sobre:
- Informa√ß√µes de sinopse e enredo.
- Recomenda√ß√µes personalizadas (Ex: "Filmes de com√©dia dos anos 90").
- Elenco, diretores e curiosidades.
- Avalia√ß√µes (IMDb, Rotten Tomatoes).
- Onde assistir (plataformas de streaming).

Use emojis quando apropriado e formate a resposta de forma organizada.
Mantenha as respostas concisas (m√°ximo 300 palavras).

Pergunta do usu√°rio: ${message}`;
            try {
                const requestBody = {
                    contents: [{
                        parts: [{
                            text: prompt
                        }]
                    }],
                    generationConfig: {
                        temperature: 0.7,
                        topK: 40,
                        topP: 0.95,
                        maxOutputTokens: 800,
                    }
                };

                const response = await fetch(GEMINI_API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    if (response.status === 429) {
                        throw new Error('Limite de requisi√ß√µes atingido. Tente novamente em alguns minutos.');
                    } else if (response.status === 403) {
                        throw new Error('Chave da API inv√°lida ou sem permiss√£o.');
                    }
                    throw new Error(`Erro na API: ${response.status} - ${errorText}`);
                }

                const data = await response.json();
                
                // Extra√ß√£o robusta da resposta da IA
                let responseText = null;
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts[0]) {
                    responseText = data.candidates[0].content.parts[0].text;
                } else if (data.candidates && data.candidates[0] && data.candidates[0].parts && data.candidates[0].parts[0]) {
                    responseText = data.candidates[0].parts[0].text;
                }
                
                if (responseText && responseText.trim()) {
                    return responseText.trim();
                } else if (data.error) {
                    throw new Error(`Erro da API: ${data.error.message || JSON.stringify(data.error)}`);
                } else {
                    return `ü§ñ Desculpe, houve um problema na comunica√ß√£o com a IA. 
Posso ajudar com informa√ß√µes sobre os t√≠tulos em destaque abaixo, ou voc√™ pode tentar fazer a pergunta novamente.

Para perguntas espec√≠ficas, tente:
‚Ä¢ "Me fale sobre Oppenheimer"
‚Ä¢ "Qual o melhor filme de terror na Netflix?"
‚Ä¢ "Quem dirigiu Pulp Fiction?"`;                
                }
            } catch (error) {
                console.error('‚ùå Erro completo:', error);
                throw error;
            }
        }

        function addMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            
            if (type === 'user') {
                messageDiv.innerHTML = `<strong>üë§ Voc√™:</strong><br>${escapeHtml(message)}`;
            } else {
                messageDiv.innerHTML = `<strong>ü§ñ Movie Assistant:</strong><br>${formatBotMessage(message)}`;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function formatBotMessage(message) {
            // Converte markdown b√°sico para HTML (negrito, it√°lico)
            // Nota: Uso de replace mais simples. O original tinha um erro na regex.
            return escapeHtml(message)
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // **negrito**
                .replace(/\*(.*?)\*/g, '<em>$1</em>') // *it√°lico*
                .replace(/\n/g, '<br>');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function setLoading(show) {
            isLoading = show;
            loading.classList.toggle('show', show);
            sendButton.disabled = show;
            sendButton.textContent = show ? 'Pensando...' : 'Enviar üöÄ';
        }

        // Adiciona alguns exemplos de perguntas
        setTimeout(() => {
            const examples = [
                "üí° Experimente perguntar:",
                "‚Ä¢ 'Me recomende filmes de fic√ß√£o cient√≠fica'",
                "‚Ä¢ 'Qual o elenco de Stranger Things?'",
                "‚Ä¢ 'Onde posso assistir O Irland√™s?'",
                "‚Ä¢ 'Me fale sobre um document√°rio popular'",
            ];
            
            addMessage(examples.join('\n'), 'bot');
        }, 2000);
    </script>
 </body>
</html>